# StrategicAssetAllocationAssistant
本项目为我用于辅助自己进行战略资产配置的android app。
我在A股进行投资，所有投资标的都是A股的上市股票或者场外的基金/现金。

它负责完成以下工作：
* 维护一份资产配置
	* 允许用户手动修改资产配置
	* 资产配置在存储时为一个表格，表格中每一行对应于一种资产，表格有如下列：
		* 资产名称：用于区分不同类型的资产
		* 资产ID：每个资产都有一个唯一标识符
		* 类型：
			* 货币基金：净值始终为1，需要查询万份基金日收益来计算市场价值
			* 场外基金：每交易日更新一次净值，用最新净值来计算市场价值
			* 场内股票：交易日实时监测其市值来计算市场价值
		* 编号：每种基金和股票都是有一个固定的编号的，可以使用该编号查询到它的信息
		* 份额：我持有多少份该类资产
		* 单位价格：每份资产的价值为多少
		* 更新时间：上一次更新净值的时间
		* 目标占比：该类资产应当占总资产多少
	* 资产配置还有如下项目：
		* 现金：表示现在有多少现金
			* 用于买入卖出的中间媒介
			* 交易总是会途径现金：卖出后变成现金，再将现金经买入变成其他类型的资产
			* 因为卖出买入很少会同时发生，因此需要使用现金做一个中间媒介
	* 资产配置存储在本地
	* 资产配置可以被以json文件的形式导入导出
* 实时更新各类资产的市场数据
	* app在后台运行
	* 每隔一段时间，app就会查询市场数据更新各类资产配置中的份额/净值/市值
	* 也允许用户手动触发更新
	* 提供设置选项来允许用户修改更新频率
		* 货币基金和场外基金其实都只需要每天更新一次就够了
		* 场内股票也只需在交易时间段内每隔一段时间更新一次就够了
* 为用户提供检查当前资产配置的直观界面
	* 该界面应当根据资产配置计算各类资产的：
		* 占总资产的占比
		* 偏离目标占比多少
		* 当前市场价值
		* 目标占比下的市场价值
		* 偏离目标占比多少市场价值
* 实时监测交易机会
	* 按照我给定的一套规则，每隔一段时间根据当前资产配置和市场数据，判断是否有交易机会
		* 有交易机会时手机上弹出消息提醒我
	* 也提供一个按钮用来主动查询是否有交易机会
		* 主动查询时不弹出消息
	* 一次查询中如果有多个可行的交易机会的话，那么就生成多条
	* 交易机会本身就算是一种数据
		* 它可以被转换成交易记录
	* 允许用户一键清空所有交易机会
	* 交易规则的设计暂时留空
* 为资产配置维护一组交易记录
	* 该app不自动进行交易，而仅仅只是提醒用户交易机会
	* 当用户实际完成交易后可以进入app的消息列表里一键勾选之前弹出的消息
		* 此时该消息就会被转化为一条实际的交易记录，更新资产配置的情况
	* 用户也可以手动生成一条交易记录
	* 交易记录由以下信息构成：
		* 交易类型：买入还是卖出
		* 目标资产ID
		* 交易份额：
			* 如果是基金就表示交易多少份
			* 如果是股票就表示交易多少股
		* 交易费用：交易本身的费用，包括佣金和税率
			* 具体计算方法暂时留空
		* 交易金额：这笔交易包含交易费用在内的总金额
			* 因为买入卖出的对象总有一个是现金
			* 买入时就直接从现金里扣除交易金额
			* 卖出时就直接向现金里增加交易金额

APP设计思路：
* APP的界面风格应当简约现代，重点在于让我能直观快速地获取信息并且进行操作
* APP应当轻量化，减少额外的功耗开销，也让操作时更加顺滑
* APP采用的技术栈应当现代化和普遍，避免使用古早或太小众的，从而降低维护成本


交易机会规则：
* 最小单笔金额=1000
* 买入机会：
	* 可能的买入机会发生在每周三14:00
		* 数据库里会在资产配置里记录下上一次可能的买入机会的发生时间
		* 如果上一次可能的买入机会的发生时间是在周三14:00之前，而现在时间是周三14:00之后了，则触发一次可能的买入机会
		* 如果周三是非交易日，则顺延到最近一次交易日的14:00
			* 程序里可以通过查询待买入资产的上一笔交易时间来判断当天是否为交易日
	* 买入对象：
		* 以距离目标占比最远的资产为目标
		* 例如A,B,C三类资产的目标占比都是5%，当前占比分别为2%,3%,1%，则这次买入的目标就为仅占1%的C资产
	* 计划买入金额：
		* 计算：待投放金额 = 货币基金当前金额 - 货币基金目标金额
		* 计算：最小单次投放金额 = 总资产 * 1%
		* 若 最小单次投放金额*25 < 待投放金额：
			* 计划买入金额 = 待投放金额/25
		* 否则若 最小单次投放金额 <= 待投放金额：
			* 计划买入金额 = 最小单次投放金额
		* 否则：
			* 计划买入金额 = 待投放金额
	* 买入金额 = 一手近似处理后的计划买入金额
		* 因为在A股交易必须以100股为一手，所以交易金额必须为资产单价的100倍的整数倍
		* 买入时总是向下取整
			* 不过如果向下取整没有可选项，则向上取整（这发生在一手价格>计划买入金额时）
	* 若 买入金额>待投放金额 或 买入金额<最小单笔交易金额，则放弃本次买入机会
* 卖出机会：
	* 当任何一类资产偏离其目标占比超过总资产的0.4%时就生成一个卖出机会
	* 计划卖出金额：
		* 卖出超出部分的一半，从而让资产占比回归目标占比
		* 例如超出总资产的0.4%时，就卖出0.2%；超出0.5%时就卖出0.25%
	* 卖出金额 = 一手近似处理后的计划卖出金额
		* 因为在A股交易必须以100股为一手，所以交易金额必须为资产单价的100倍的整数倍
		* 卖出时总是向上取整
			* 不过如果向上取整就会导致卖出后该资产低于目标占比的0.4%时，就反过来向下取整
	* 若 卖出金额<最小单笔交易金额，则放弃本次买入机会